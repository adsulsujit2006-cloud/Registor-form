package com.bank.serviceIMPL;

import com.bank.service.RBI;
import com.bank.validationchecker.Validation;
import com.bank.model.Account;

import com.bank.validationchecker.Validation;
import java.util.Scanner;

public class Hdfc implements RBI {

	Account account = new Account();

	boolean isAccountCreated = false;
	boolean isLoggedIn = false;

	private Account[] accounts = new Account[5];

	@Override
	public void createAccount() {

		if (!isAccountCreated) {

			Scanner scanner = new Scanner(System.in);

			System.out.println("---------Account Creation Is Started---------");

			System.out.println("Enter the number of accounts user want to creat : ");
			int num = scanner.nextInt();
			if (num <= accounts.length) {
				for (int i = 0; i < num; i++) {
					Account account = new Account();

					// Taking user first name as input
					System.out.println("Please enter your first name :");
					String firstname = Validation.checkName();
					account.setFirstName(firstname);

					// Taking user last name as input
					System.out.println("Please enter your last name :");
					String lastName = Validation.checkName();
					account.setLastName(lastName);

					// Taking user Aadhar number as input
					System.out.println("Please enter your Aadhar Number :");
					long adharNumber = scanner.nextLong();
					account.setAadharNumber(adharNumber);

					// Taking user PAN number as input
					System.out.println("Please enter your Pan Number :");
					String panNumber = Validation.validPanNumber();
					account.setPanNumber(panNumber);

					// Taking user Mobile number as input
					account.setMobileNumber(Validation.checkMobileNumber());

					// Taking initial deposit amount
					account.setBalance(Validation.deposite());

					// Taking username for login
					System.out.println("Please set Username or Password :");
					System.out.println("Enter your Username :");
					String userName = scanner.next();
					account.setUserName(userName);

					// Taking password for login
					System.out.println("Enter your Password :");
					String loginPass = scanner.next();
					account.setPassword(loginPass);

					// Generating unique account number
					account.setAccountNumber(Validation.genrateAcNumber());
					System.out.println("Your Account Number Is : " + account.getAccountNumber() + "\n");

					System.out.println("==== Account Created Succesfuly ====");
					isAccountCreated = true;
					accounts[i] = account;
					System.out.println("---------Account Creation Is Complete---------\n");
				}

			} else {
				System.out.println("Account Creation Limit exceeds..!");
			}

		} else {

			System.out.println("Account is already created. \n");
			System.out.println("You need To login first.");
			login();

		}

	}

	@Override
	public void displayAccountDetails() {

		if (isAccountCreated) {

			if (isLoggedIn) {

				for (Account ac : accounts) {
					if (ac != null) {
						System.out.println(ac);
					}
				}

//				for(int i=0; i<acounts.length; i++) {
//					System.out.println(acounts[i]);
//				}
//				System.out.println();
			} else {
				System.out.println("You need To login first.");
				login();
			}
		} else {
			System.out.println("ACCOUNT IS NOT FOUND, You Need To Creat ACCOUNT Try 1st Option.");
			System.out.println("--------------------------------------------------------------------------------------");
		}

	}

	@Override
	public void checkBalance() {
		if (isAccountCreated) {
			if (isLoggedIn) {

				for (int i = 0; i < accounts.length; i++) {
					if (accounts[i] != null && accounts[i].getAccountNumber() == checkAccountNumber()) {
						System.out.println("Your Current Balance Is : " + accounts[i].getBalance());
					}
				}
			} else {
				System.out.println("You need To login first.");
				login();
			}
		} else {
			System.out.println("ACCOUNT IS NOT FOUND, You Need To Creat ACCOUNT Try 1st Option.");
			System.out.println("--------------------------------------------------------------------------------------");
		}

	}

	@Override
	public void depositeAmount() {

		if (isAccountCreated) {
			if (isLoggedIn) {
				Scanner sc = new Scanner(System.in);
				System.out.println("Please enter amount you want to Deposite :");
				double newdeposite = sc.nextDouble();
				if (newdeposite > 0) {
					double oldBalance = account.getBalance();
					double newBalance = oldBalance + newdeposite;
					account.setBalance(newBalance);
					System.out.println("Amount Deposited Successfuly \n");
				} else {
					System.out.println(
							">>>>>>>>> TRANSACTION FAILED : Deposit amount cannot be zero or negative. <<<<<<<<<\n");
					depositeAmount();
				}
			} else {
				System.out.println("You need To login first.");
				login();
			}
		} else {
			System.out.println("ACCOUNT IS NOT FOUND, You Need To Creat ACCOUNT Try 1st Option.");
			System.out.println("--------------------------------------------------------------------------------------");
		}

	}

	@Override
	public void withdrawlAmount() {
		if (isAccountCreated) {
			if (isLoggedIn) {
				boolean flag = false;

				Scanner sc = new Scanner(System.in);
				System.out.println("Enter Amount you want to Withdraw: ");
				double withdrowAmount = sc.nextInt();
				double newBalance = 0;
				for (int i = 0; i < accounts.length; i++) {
					if (accounts[i] != null && withdrowAmount < accounts[i].getBalance() && withdrowAmount > 0) {
						newBalance = accounts[i].getBalance() - withdrowAmount;
						accounts[i].setBalance(newBalance);
						System.out.println("Withdrowl Successfull...!");
						flag = true;
					}
				}
				if (!flag) {
					System.out.println("Invalide Amount...!");
					System.out.println("--------------------------------------");
					withdrawlAmount();
				}

			} else {
				System.out.println("You need To login first.");
				login();
			}
		} else {
			System.out.println("ACCOUNT IS NOT FOUND, You Need To Creat ACCOUNT Try 1st Option.");
			System.out.println("--------------------------------------------------------------------------------------");
		}
	}

	@Override
	public void login() {

		if (!isLoggedIn) {
			Scanner sc = new Scanner(System.in);
			System.out.println("Enter your Username and Password :");

			System.out.print("USERNAME : ");
			String userName = sc.next();

			System.out.print("PASSWORD : ");
			String password = sc.next();

			boolean flag = false;

			for (int i = 0; i < accounts.length; i++) {

//				for(Account ac : accounts) {
//					if(ac.getUserName().equals(userName)&&ac.getPassword().equals(password)) {
//						isLoggedIn = true;
//						flag = true; 
//						System.out.println("Login Successfuly");
//					}

				if (accounts[i] != null && accounts[i].getUserName().equals(userName)
						&& accounts[i].getPassword().equals(password)) {
					isLoggedIn = true;
					flag = true;
					System.out.println("Login Successfuly");
				}
			}

			if (!flag) {
				System.out.println("Invalid Username or Password \n");
				login();

			}

		} else

		{
			System.out.println("ACCOUNT IS NOT FOUND, You Need To Creat ACCOUNT Try 1st Option.");
			System.out.println("--------------------------------------------------------------------------------------");
			createAccount();
		}
	}

	@Override
	public void logOut() {
		isLoggedIn = false;
		System.out.println("logout Successfuly...");
	}

	@Override
	public void updateProfile() {
		if(isAccountCreated) {
		if (isLoggedIn) {
			long acNo = checkAccountNumber();
			Scanner sc = new Scanner(System.in);

			System.out.println(">->->->->-> UPDATE MENU <-<-<-<-<-<");
			System.out.println("1 -> First Name ");
			System.out.println("2 -> Last Name ");
			System.out.println("3 -> Mobile Number ");
			System.out.println("4 -> Exit ");

			System.out.println("Enter Your Choise : ");
			byte ch = sc.nextByte();

			switch (ch) { 
			case 1:
				System.out.println("Please enter your Name :");
				String fname = sc.next();
				for (int i = 0; i < accounts.length; i++) {
					if (accounts[i] != null && accounts[i].getAccountNumber() == acNo) {
						accounts[i].setFirstName(fname);
					}
				}
				System.out.println("First Name Updated Successfully...!");
				break;

			case 2:
				System.out.println("Please enter your Name :");
				String lname = sc.next();
				for (int i = 0; i < accounts.length; i++) {
					if (accounts[i] != null && accounts[i].getAccountNumber() == acNo) {
						accounts[i].setLastName(lname);
					}
				}
				System.out.println("Last Name Updated Successfully...!");
				break;

			case 3:
				// System.out.println("Please enter your Mobile Number :");
				long mobileNumber = Validation.checkMobileNumber();

				for (int i = 0; i < accounts.length; i++) {
					if (accounts[i] != null && accounts[i].getAccountNumber() == acNo) {
						accounts[i].setMobileNumber(mobileNumber);
					}
				}
				System.out.println("Mobile Number Updated Successfully...!");
				break;

			case 4:

				break;
			default:
				System.out.println("Invalid choice. Please try again...!");
				updateProfile();
				break;
			}

		} else {
			System.out.println("You need To login first.");
			login();
		}
	  }else {
		  System.out.println("ACCOUNT IS NOT FOUND, You Need To Creat ACCOUNT Try 1st Option.");
		  System.out.println("--------------------------------------------------------------------------------------");
	  }

	}
	
	

	private long checkAccountNumber() {
		Scanner sc = new Scanner(System.in);
		System.out.println("Enter Your Account Number : ");
		long acNumber = sc.nextLong();
		boolean flag = false;
		for (int i = 0; i < accounts.length; i++) {
			if (accounts[i] != null && accounts[i].getAccountNumber() == acNumber) {
				flag = true;
				return acNumber;
			}
		}
		if (!flag) {
			System.out.println("Account Not Found....!");
			System.out.println("---------------------------------------------------------");
			return checkAccountNumber();
		}
		return acNumber;
	}

}